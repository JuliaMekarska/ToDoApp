<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <title>ToDo App</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
<div class="contents">
    <h1>ToDo App</h1>

    <div class="field">
        <input class="textField" type="text" id="taskInput" placeholder="New task">
        <select id="typeSelect"></select>
        <button class="addButton" onclick="addToDo()">Add Task</button>
    </div>

    <div id="todoContainer"></div>
</div>
<footer>
    <p>Authors: Mati, Ania & Jula<br>
    <a href="https://wallpapers.com/images/file/cute-cat-pictures-gnxzfakjiaymdck3.jpg">cool cat</a></p>
</footer>
<script>
    const TODO_API = "/api/todo";
    const TYPE_API = "/api/type";
    
    function loadTypes() {
      fetch(TYPE_API)
        .then(res => res.json())
        .then(types => {
          const select = document.getElementById("typeSelect");
          select.innerHTML = types.map(t => `<option value="${t.id}">${t.name}</option>`).join("");
        });
    }
    
    function loadToDos() {
      fetch(TODO_API)
        .then(res => res.json())
        .then(todos => {
          const container = document.getElementById("todoContainer");
          container.innerHTML = "";
          const grouped = {};
          todos.forEach(t => {
            const type = t.type ? t.type.name : "Bez typu";
            if (!grouped[type]) grouped[type] = [];
            grouped[type].push(t);
          });
          for (const type in grouped) {
            const tasks = grouped[type];
            container.innerHTML += `
              <div class="type-block">
                <div class="type-title">${type}</div>
                <ul>
                  ${tasks.map(task => `
                    <li class="${task.completed ? "completed" : ""}">
                      ${task.name}
                      <button onclick="updateToDo(${task.id})">âœ”</button>
                      <button onclick="deleteToDo(${task.id})">ðŸ—‘</button>
                    </li>
                  `).join("")}
                </ul>
              </div>
            `;
          }
        });
    }
    
    function addToDo() {
      const task = document.getElementById("taskInput").value.trim();
      const typeId = document.getElementById("typeSelect").value;
      if (!task) return;
      fetch(TODO_API, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ name: task, completed: false, type: { id: typeId } })
      }).then(() => {
        document.getElementById("taskInput").value = "";
        loadToDos();
      });
    }
    
    function updateToDo(id) {
      fetch(`${TODO_API}/${id}`, { method: "PUT" })
        .then(() => loadToDos());
    }
    
    function deleteToDo(id) {
      fetch(`${TODO_API}/${id}`, { method: "DELETE" })
        .then(() => loadToDos());
    }
    
    loadTypes();
    loadToDos();
</script>
</body>
</html>
